# 业务场景拆解 — SuperDriver 开发能力建设

> **需求来源**: team/requirements.md
> **拆解日期**: 2026-02-26
> **业务经理**: BA

---

## 领域术语表

| 术语 | 定义 | 数据实体 |
|------|------|----------|
| AGENTS.md | 项目架构地图文件，描述目录结构、文件职责和模块依赖 | 根目录 Markdown 文件 |
| Agent 规则 | AI Agent 在项目内的行为约束和上下文感知配置 | `.agent/rules/*.md` |
| 工作流 | 标准化开发操作流程的 Markdown 定义 | `.agent/workflows/*.md` |
| Diátaxis | 文档组织四象限框架：教程 / 解释 / 指南 / 参考 | `docs/` 子目录 |
| 散落组件 | 应属于子目录但直接放在 `components/` 根下的 `.tsx` 文件 | `components/*.tsx` |
| Agent SDK | 内嵌的 `@survival/agent-sdk` 包，提供 Agent 交互能力 | `packages/agent-sdk/` |
| 坏味道 | 代码中暗示设计问题的模式（过长函数、循环依赖等） | 代码级概念 |

---

## 业务链路图

### 主链路 (Happy Path)

```
PM 现状审计
  → 确认缺失基础设施清单
  → Alpha 安装依赖 + 运行测试（验证环境可用）
  → Alpha 深度审计代码（产出架构知识）
  → Alpha 创建 AGENTS.md + .agent/ 规则
  → Beta 建立 docs/ Diátaxis 体系
  → Beta 整理根目录 + 同步 README
  → Reviewer 全面审查
  → Documenter 沉淀文档
  → PM 验收 + 归档
```

### 异常链路

```
npm install 失败
  → 检查 Node.js 版本 / 清理缓存 → 重试
  → 仍失败 → 标记 BLOCK → 报告用户

npm test 存在失败用例
  → 分析原因：mock 配置 / 依赖破坏
  → 修复测试 → 重新运行
  → 仍失败 → 记录 known issues → 继续架构任务

组件归位后 import 引用断裂
  → grep 全量检查引用路径
  → 修正所有引用 → 重新测试
```

---

## 场景矩阵

### 场景 1: 测试环境就绪

| # | 前置条件 | 用户动作 | 预期结果 | 边界/备注 |
|---|----------|----------|----------|-----------|
| 1.1 | node_modules 不存在 | 执行 `npm install` | 依赖安装成功 | Happy Path |
| 1.2 | 依赖已安装 | 执行 `npm test` | 所有测试通过或输出清晰的失败信息 | Happy Path |
| 1.3 | Node.js 版本不匹配 | 执行 `npm install` | 输出版本警告但不阻塞 | 边界：版本兼容 |

### 场景 2: AGENTS.md 创建

| # | 前置条件 | 用户动作 | 预期结果 | 边界/备注 |
|---|----------|----------|----------|-----------|
| 2.1 | 项目代码已审计 | 创建 AGENTS.md | 包含完整目录树 + 每文件职责 + 依赖关系 | Happy Path |
| 2.2 | 存在散落组件 | AGENTS.md 描述 | 准确标注哪些组件散落，建议归位方向 | P1 |
| 2.3 | 有废弃 / 未使用文件 | AGENTS.md 描述 | 标注废弃状态和清理建议 | P2 |

### 场景 3: Agent 规则建立

| # | 前置条件 | 用户动作 | 预期结果 | 边界/备注 |
|---|----------|----------|----------|-----------|
| 3.1 | `.agent/` 不存在 | 创建规则文件 | `.agent/rules/Gemini.md` 存在，引用全局规则 | Happy Path |
| 3.2 | `.agent/` 不存在 | 创建工作流文件 | `.agent/workflows/` 包含项目适配的工作流 | Happy Path |
| 3.3 | `.gitignore` 含 `.agent/*` | 检查配置 | `.agent/` 不被 gitignore（当前被忽略！需修正） | 边界：.gitignore 冲突 |

### 场景 4: Diátaxis 文档体系

| # | 前置条件 | 用户动作 | 预期结果 | 边界/备注 |
|---|----------|----------|----------|-----------|
| 4.1 | docs/ 仅有 README.md | 建立子目录 | `getting-started/` `architecture/` `guides/` `reference/` 存在 | Happy Path |
| 4.2 | 各子目录已创建 | 写入初始文档 | 每个子目录至少有一个 README.md | Happy Path |
| 4.3 | `docs/README.md` 已存在 | 更新为索引页 | 链接到所有四象限入口 | 覆盖已有文件 |

### 场景 5: 根目录组件整理

| # | 前置条件 | 用户动作 | 预期结果 | 边界/备注 |
|---|----------|----------|----------|-----------|
| 5.1 | components/ 根下有 24 个散落 .tsx | 分析哪些应归入子目录 | 产出整理清单，标注目标子目录 | 仅分析阶段，L 级不直接移动 |
| 5.2 | README.md 有过时信息 | 同步更新 | README 与实际项目结构一致 | Happy Path |

### 场景 6: team/ 协作目录

| # | 前置条件 | 用户动作 | 预期结果 | 边界/备注 |
|---|----------|----------|----------|-----------|
| 6.1 | team/ 仅为临时目录 | 创建 archive/ | `team/archive/` 存在 | Happy Path |
| 6.2 | team/ 中间文件 | 检查 .gitignore | team/ 中间文件在归档前不提交到 git | 安全 |

---

## 边界条件清单

| # | 条件 | 预期行为 | 优先级 |
|---|------|----------|--------|
| B1 | `.gitignore` 当前忽略 `.agent/*` | 需要移除此规则，`.agent/` 应纳入版本控制 | P0 |
| B2 | `constants.ts` 使用 `@deprecated` 导出 | AGENTS.md 应标注废弃状态 | P1 |
| B3 | `components/` 同时存在散落文件和子目录 | 审计报告应清晰区分，不遗漏 | P1 |
| B4 | `docs/README.md` 中 Expo SDK 版本 (52) 与 package.json (54) 不一致 | 同步更新 | P0 |
| B5 | `API_REFERENCE.md` 在根目录而非 `docs/reference/` | 应建立引用关系或迁移 | P1 |
| B6 | `app.json` 配置是否与当前架构一致 | 审计时检查 | P2 |

---

## 需求覆盖映射

| AC 编号 | AC 内容 | 覆盖场景 | 状态 |
|---------|---------|----------|------|
| AC-1 | AGENTS.md 包含目录树 + 职责 + 依赖 | 场景 2.1 | ✅ 已覆盖 |
| AC-2 | 新开发者 5 分钟理解架构 | 场景 2.1, 2.2 | ✅ 已覆盖 |
| AC-3 | .agent/rules/ 存在项目级规则 | 场景 3.1 | ✅ 已覆盖 |
| AC-4 | .agent/workflows/ 存在工作流 | 场景 3.2 | ✅ 已覆盖 |
| AC-5 | npm test 通过 | 场景 1.1, 1.2 | ✅ 已覆盖 |
| AC-6 | team/ 目录就绪 | 场景 6.1 | ✅ 已覆盖 |
| AC-7 | .gitignore 正确 | 场景 3.3, 6.2, B1 | ✅ 已覆盖 |
| AC-8 | docs/ Diátaxis 四象限 | 场景 4.1 | ✅ 已覆盖 |
| AC-9 | docs/README.md 完整索引 | 场景 4.3 | ✅ 已覆盖 |
| AC-10 | docs/architecture/ 模块架构 | 场景 4.2 | ✅ 已覆盖 |
| AC-11 | 根目录无散落业务组件 | 场景 5.1 | ✅ 已覆盖 |
| AC-12 | README.md 内容一致 | 场景 5.2, B4 | ✅ 已覆盖 |

---

## 技术风险清单（L 级）

| # | 风险 | 影响 | 建议 Spike |
|---|------|------|-----------|
| R1 | `.gitignore` 忽略 `.agent/*`，建立规则后需修正才能提交 | 阻塞代码提交 | Alpha 优先修正 .gitignore |
| R2 | node_modules 未安装，可能存在依赖冲突 | 阻塞测试验证 | Alpha 先 npm install 验证 |
| R3 | 24 个散落组件是否有跨模块依赖，移动可能破坏引用 | 风险：import 断裂 | 本次仅审计标注，不执行移动 |

### Spike 建议

1. **Spike-1: 依赖安装验证** — 范围：`npm install` + `npm test`，验证基础设施可用性，时间盒 15 分钟
2. **Spike-2: 散落组件依赖分析** — 范围：分析 24 个根文件的 import/被引用关系，确定是否安全归位，时间盒 20 分钟

---

## Alpha TDD 建议

> 本次需求是基础设施建设，无业务逻辑代码产出，TDD 聚焦于**验证性测试**：

1. **测试组 1 — 环境验证**: 验证 `npm test` 现有测试全部通过（场景 1.1-1.3）
2. **测试组 2 — 文件结构验证**: 验证关键文件存在且格式正确（场景 2.1, 3.1, 3.2, 4.1）
3. **边界测试组**: 验证 .gitignore 不忽略 .agent/、README 版本号一致（B1, B4）
